!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.X2JS=t()}(this,(function(){return function(e){e=e||{},function(){void 0===e.escapeMode&&(e.escapeMode=!0);e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0);e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0);void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0);e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1);e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1)}();var t=1,n=3,r=4,i=8,a=9;function s(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function o(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function l(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(t,n,r))break}return i!=e.length}function c(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&l(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function u(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function f(n,r,i,a){return!(r==t&&e.xmlElementsFilter.length>0)||l(e.xmlElementsFilter,n,i,a)}function _(o,d){if(o.nodeType==a){for(var p=new Object,m=o.childNodes,x=0;x<m.length;x++){if((g=m.item(x)).nodeType==t)p[h=s(g)]=_(g,h)}return p}if(o.nodeType==t){(p=new Object).__cnt=0;for(m=o.childNodes,x=0;x<m.length;x++){var g,h=s(g=m.item(x));if(g.nodeType!=i){var y=d+"."+h;f(p,g.nodeType,h,y)&&(p.__cnt++,null==p[h]?(p[h]=_(g,y),c(p,h,y)):(null!=p[h]&&(p[h]instanceof Array||(p[h]=[p[h]],c(p,h,y))),p[h][p[h].length]=_(g,y)))}}for(var v=0;v<o.attributes.length;v++){var b=o.attributes.item(v);p.__cnt++,p[e.attributePrefix+b.name]=b.value}var F=function(e){return e.prefix}(o);return null!=F&&""!=F&&(p.__cnt++,p.__prefix=F),null!=p["#text"]&&(p.__text=p["#text"],p.__text instanceof Array&&(p.__text=p.__text.join("\n")),e.stripWhitespaces&&(p.__text=p.__text.trim()),delete p["#text"],"property"==e.arrayAccessForm&&delete p["#text_asArray"],p.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0];return l(e.datetimeAccessFormPaths,t,n,i)?u(t):t}return t}(p.__text,h,d+"."+h)),null!=p["#cdata-section"]&&(p.__cdata=p["#cdata-section"],delete p["#cdata-section"],"property"==e.arrayAccessForm&&delete p["#cdata-section_asArray"]),0==p.__cnt&&"text"==e.emptyNodeForm?p="":1==p.__cnt&&null!=p.__text?p=p.__text:1!=p.__cnt||null==p.__cdata||e.keepCData?p.__cnt>1&&null!=p.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==p.__text||""==p.__text.trim())&&delete p.__text:p=p.__cdata,delete p.__cnt,!e.enableToStringFunc||null==p.__text&&null==p.__cdata||(p.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),p}if(o.nodeType==n||o.nodeType==r)return o.nodeValue}function d(t,n,r,i){var a="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=r)for(var s=0;s<r.length;s++){var l=r[s],c=t[l];e.escapeMode&&(c=o(c)),a+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?a+='"'+c+'"':a+="'"+c+"'"}return a+=i?"/>":">"}function p(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function m(t,n){return!!("property"==e.arrayAccessForm&&function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(n.toString(),"_asArray")||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function)}function x(e){var t=0;if(e instanceof Object)for(var n in e)m(e,n)||t++;return t}function g(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||l(e.jsonPropertiesFilter,t,n,r)}function h(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function y(t){var n="";return t instanceof Object?n+=function(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=o(t.__text):n+=t.__text),n}(t):null!=t&&(e.escapeMode?n+=o(t):n+=t),n}function v(e,t){return""===e?t:e+"."+t}function b(e,t,n,r){var i="";if(0==e.length)i+=d(e,t,n,!0);else for(var a=0;a<e.length;a++)i+=d(e[a],t,h(e[a]),!1),i+=F(e[a],v(r,t)),i+=p(e[a],t);return i}function F(e,t){var n="";if(x(e)>0)for(var r in e)if(!m(e,r)&&(""==t||g(e,r,v(t,r)))){var i=e[r],a=h(i);if(null==i||null==i)n+=d(i,r,a,!0);else if(i instanceof Object)if(i instanceof Array)n+=b(i,r,a,t);else if(i instanceof Date)n+=d(i,r,a,!1),n+=i.toISOString(),n+=p(i,r);else x(i)>0||null!=i.__text||null!=i.__cdata?(n+=d(i,r,a,!1),n+=F(i,v(t,r)),n+=p(i,r)):n+=d(i,r,a,!0);else n+=d(i,r,a,!1),n+=y(i),n+=p(i,r)}return n+=y(e)}this.parseXmlString=function(e){var t,n=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser,i=null;if(!n)try{i=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){i=null}try{t=r.parseFromString(e,"text/xml"),null!=i&&t.getElementsByTagNameNS(i,"parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?u(e):e},this.xml2json=function(e){return _(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return F(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}}}));
